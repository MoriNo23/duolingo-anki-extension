Act煤a como un experto en desarrollo de software y educaci贸n. Tengo 6 archivos TypeScript de una extensi贸n Firefox que integra Duolingo con Anki usando IA.

Analiza estos archivos y crea una roadmap educativa estructurada as铆:

 ESTRUCTURA DEL LIBRO:
1. Fundamentos (conceptos clave)
2. Arquitectura (flujo y patrones)
3. Implementaci贸n (c贸digo detallado)
4. Integraci贸n (APIs externas)
5. Mejores pr谩cticas y troubleshooting

 OBJETIVO DE APRENDIZAJE:
Para cada archivo, identifica:
- Patrones de dise帽o usados
- Conceptos t茅cnicos importantes
- Lecciones aprendidas
- Aplicaciones pr谩cticas

 PROBLEMAS CRTICOS ENFATIZADOS:
- **Debounce proper vs incorrecto**: C贸mo el setTimeout mal ubicado causaba "undefined"
- **JSON parsing robusto**: Gemini devuelve texto con formato, no JSON puro
- **Model detection din谩mico**: "model was not found: Basic" en AnkiConnect
- **Store timing**: Cu谩ndo limpiar arrays vs cu谩ndo procesarlos
- **Modo oscuro compatibility**: Estilos CSS que funcionen en ambos temas

 **PROBLEMA RECURRENTE CRTICO - UNDEFINED GUARD:**
**El patr贸n `if(elementContainer) return ""` es FUNDAMENTAL:**
- Por qu茅 Duolingo a veces no carga los elementos
- C贸mo el MutationObserver puede ejecutarse antes de que exista el DOM
- Estrategias de defensive programming
- Cu谩ndo usar `return ""` vs `return null` vs `throw error`
- Este patr贸n salva la extensi贸n de romperse constantemente

 **ENFOQUE ESPECIAL EN OBTENER DOM:**
**`obtenerDom.ts` y `obtenerTextoDuolingo.ts` son LA BASE:**
- Sin estos archivos, la extensi贸n no funciona
- Selectores CSS espec铆ficos de Duolingo
- C贸mo Duolingo estructura sus ejercicios
- T茅cnicas para extraer texto de diferentes tipos de challenges
- **El problema del timing: cu谩ndo buscar elementos vs cu谩ndo ya existen**
- Manejo de cambios en el DOM de Duolingo

锔 **DUOLINGO USA PREACT/REACT - IMPACTO CRTICO:**
**Esto cambia TODO sobre c贸mo interactuar con Duolingo:**
- **Virtual DOM**: Los elementos no existen f铆sicamente hasta renderizado
- **Component lifecycle**: Los elementos aparecen/desaparecen din谩micamente
- **State-driven updates**: El DOM cambia por estado, no por manipulaci贸n directa
- **Por qu茅 el `if(elementContainer) return ""` es a煤n MS importante**
- **C贸mo Preact afecta los MutationObserver timing**
- **Estrategias espec铆ficas para apps React/Preact vs sitios est谩ticos**
- **Hydration issues**: Cuando el servidor y cliente no coinciden

 FORMATO DE SALIDA:
- T铆tulos claros para cada secci贸n
- Explicaciones paso a paso
- Ejemplos de c贸digo con comentarios
- Diagramas de flujo (texto)
- Puntos clave para tarjetas Anki
- **Secci贸n "Problemas Comunes y Soluciones"**
- **Caso de estudio: El patr贸n if(elementContainer) return ""**
- **Caso de estudio: Interactuar con apps Preact/Duolingo**

 ROADMAP EDUCATIVA:
Ordena los temas de principiante a avanzado, indicando prerrequisitos y resultados esperados.

Enf贸cate en que alguien aprenda NO SOLO a construir extensiones, sino tambi茅n a resolver los problemas reales que enfrentamos, ESPECIALMENTE el manejo de elementos que pueden no existir en el DOM y c贸mo interactuar con aplicaciones modernas como Duolingo que usan Preact/React.
